<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barcode Scanner</title>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://unpkg.com/@zxing/library@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
body{background:linear-gradient(135deg,#1a73e8,#6c8ef5);color:#333;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
.container{width:100%;max-width:500px;background:white;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.2);overflow:hidden;}
.header{background:#1a73e8;color:white;padding:20px;text-align:center;}
.header h1{font-size:24px;margin-bottom:5px;}
.header p{opacity:0.9;font-size:14px;}
.content{padding:20px;}
.barcode-display{background:#f8f9fa;border-radius:12px;padding:20px;text-align:center;margin-bottom:20px;border:1px solid #e0e0e0;min-height:180px;display:flex;flex-direction:column;justify-content:center;align-items:center;}
#barcode{width:100%;max-width:300px;height:120px;margin:0 auto;}
#barcodeLabel{margin-top:15px;font-size:18px;font-weight:600;color:#1a73e8;min-height:25px;word-break:break-all;text-align:center;padding:0 10px;}
.input-section{margin-bottom:20px;}
.input-section input{width:100%;padding:15px;border:1px solid #ddd;border-radius:10px;font-size:16px;margin-bottom:10px;transition:all 0.3s;}
.input-section input:focus{outline:none;border-color:#1a73e8;box-shadow:0 0 0 2px rgba(26,115,232,0.2);}
.mode-buttons{display:flex;gap:10px;margin-bottom:15px;}
.mode-buttons button{flex:1;padding:12px;border:1px solid #ddd;background:white;border-radius:8px;font-size:14px;cursor:pointer;transition:all 0.3s;}
.mode-buttons button.active{background:#1a73e8;color:white;border-color:#1a73e8;}
.action-buttons{display:flex;gap:10px;margin-bottom:20px;}
button{flex:1;padding:15px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px;}
#scanBtn{background:#1a73e8;color:white;}
#scanBtn:hover{background:#0d62d9;}
#typeBtn{background:#34a853;color:white;}
#typeBtn:hover{background:#2e9849;}
#clearBtn{background:#f1f3f4;color:#5f6368;}
#clearBtn:hover{background:#e8eaed;}
.camera-section{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:100;flex-direction:column;align-items:center;justify-content:center;padding:20px;}
#preview{width:100%;max-width:500px;height:auto;border-radius:10px;background:#000;}
.scanner-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;max-width:300px;height:200px;border:2px solid #1a73e8;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;color:white;font-weight:600;background:rgba(26,115,232,0.1);pointer-events:none;text-align:center;padding:10px;}
.scanner-line{width:100%;height:2px;background:#1a73e8;position:absolute;top:20%;animation:scan 2s infinite linear;box-shadow:0 0 10px #1a73e8;}
@keyframes scan{0%{top:20%;}50%{top:80%;}100%{top:20%;}}
.close-camera{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.2);color:white;border:none;border-radius:50%;width:50px;height:50px;font-size:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;z-index:101;}
.close-camera:hover{background:rgba(255,255,255,0.3);}
.capture-btn{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:#1a73e8;color:white;border:none;border-radius:50%;width:70px;height:70px;font-size:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;z-index:101;box-shadow:0 4px 15px rgba(0,0,0,0.3);}
.capture-btn:hover{background:#0d62d9;transform:translateX(-50%) scale(1.1);}
.status{text-align:center;padding:10px;font-size:14px;color:#5f6368;min-height:20px;}
.progress{width:100%;height:6px;background:#e0e0e0;border-radius:3px;margin:10px 0;overflow:hidden;display:none;}
.progress-bar{height:100%;background:#1a73e8;width:0%;transition:width 0.3s;}
.history{margin-top:20px;border-top:1px solid #e0e0e0;padding-top:20px;}
.history h3{margin-bottom:10px;color:#1a73e8;}
#scanHistory{max-height:150px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;padding:10px;background:#f8f9fa;}
.history-item{padding:8px 10px;border-bottom:1px solid #e0e0e0;font-size:14px;display:flex;justify-content:space-between;align-items:center;}
.history-item:last-child{border-bottom:none;}
.history-content{flex:1;}
.history-type{font-size:12px;color:#5f6368;background:#e8f0fe;padding:2px 6px;border-radius:4px;margin-left:8px;}
.empty-state{text-align:center;color:#999;padding:20px;font-style:italic;}
@media(max-width:500px){.container{border-radius:15px;}.header{padding:15px;}.content{padding:15px;}button{padding:12px;font-size:14px;}.barcode-display{padding:15px;min-height:160px;}}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>Barcode Scanner</h1>
<p>Scan barcodes or text - Both generate barcodes</p>
</div>
<div class="content">
<div class="barcode-display">
<svg id="barcode"></svg>
<div id="barcodeLabel">‚Äî</div>
</div>
<div class="input-section">
<input type="text" id="textInput" placeholder="Scan or type to generate barcode...">
<div class="mode-buttons">
<button id="barcodeMode" class="active">Barcode</button>
<button id="textMode">Text</button>
</div>
<div class="action-buttons">
<button id="scanBtn">üì∑ Scan</button>
<button id="typeBtn">‚å®Ô∏è Type</button>
<button id="clearBtn">üóëÔ∏è Clear</button>
</div>
</div>
<div class="progress" id="progress">
<div class="progress-bar" id="progressBar"></div>
</div>
<div class="status" id="status">Ready - Select mode and scan</div>
<div class="history">
<h3>Recent Scans</h3>
<div id="scanHistory">
<div class="empty-state">No scans yet</div>
</div>
</div>
</div>
</div>
<div class="camera-section" id="cameraSection">
<button class="close-camera" id="closeCamera">‚úï</button>
<video id="preview" playsinline></video>
<div class="scanner-overlay">
<div class="scanner-line"></div>
<div id="scannerText">Point camera at barcode</div>
</div>
<button class="capture-btn" id="captureBtn">üì∏</button>
</div>
<script>
const input=document.getElementById("textInput");const barcode=document.getElementById("barcode");const label=document.getElementById("barcodeLabel");const scanBtn=document.getElementById("scanBtn");const typeBtn=document.getElementById("typeBtn");const clearBtn=document.getElementById("clearBtn");const video=document.getElementById("preview");const cameraSection=document.getElementById("cameraSection");const closeCamera=document.getElementById("closeCamera");const captureBtn=document.getElementById("captureBtn");const status=document.getElementById("status");const scanHistory=document.getElementById("scanHistory");const progress=document.getElementById("progress");const progressBar=document.getElementById("progressBar");const scannerText=document.getElementById("scannerText");const barcodeMode=document.getElementById("barcodeMode");const textMode=document.getElementById("textMode");let codeReader=null;let isScanning=false;let currentMode='barcode';let scanHistoryData=[];let videoStream=null;let canvas=null;let context=null;
function init(){canvas=document.createElement('canvas');context=canvas.getContext('2d');const savedHistory=localStorage.getItem('scanHistory');if(savedHistory){scanHistoryData=JSON.parse(savedHistory);updateScanHistory();}
render("");input.addEventListener("input",()=>{render(input.value);});clearBtn.addEventListener("click",clearAll);typeBtn.addEventListener("click",()=>{const text=prompt("Enter text to generate barcode:");if(text&&text.trim()!==""){input.value=text;render(text);addToHistory(text,'manual');status.textContent="Barcode generated from text";}});barcodeMode.addEventListener("click",()=>setMode('barcode'));textMode.addEventListener("click",()=>setMode('text'));scanBtn.addEventListener("click",startScanner);closeCamera.addEventListener("click",stopScanner);captureBtn.addEventListener("click",captureImage);status.textContent="Ready - Select mode and scan";}
function setMode(mode){currentMode=mode;barcodeMode.classList.remove('active');textMode.classList.remove('active');if(mode==='barcode'){barcodeMode.classList.add('active');scannerText.textContent="Point camera at barcode";status.textContent="Barcode mode - Scanning automatically";}else if(mode==='text'){textMode.classList.add('active');scannerText.textContent="Point camera at text and tap üì∏";status.textContent="Text mode - Tap capture button to scan";}}
function render(val){if(!val||val.trim()===""){barcode.innerHTML="";label.textContent="‚Äî";status.textContent="Enter or scan to generate barcode";return;}
try{barcode.innerHTML="";JsBarcode("#barcode",val,{format:"CODE128",width:2,height:100,displayValue:true,margin:10,background:"transparent",lineColor:"#000"});label.textContent=val;status.textContent="Barcode generated successfully";}catch(error){console.error("Barcode generation error:",error);label.textContent="Error: "+val;status.textContent="Error generating barcode";}}
async function startScanner(){if(isScanning)return;try{status.textContent="Starting camera...";cameraSection.style.display="flex";videoStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});video.srcObject=videoStream;video.onloadedmetadata=()=>{video.play().then(()=>{isScanning=true;if(currentMode==='barcode'){status.textContent="Scanning barcodes automatically...";startBarcodeScanning();}else{status.textContent="Ready - Point camera at text and tap üì∏";}}).catch(e=>{console.error("Error playing video:",e);status.textContent="Error starting camera";stopScanner();});};}catch(err){console.error("Camera error:",err);status.textContent="Camera error";alert("Camera error: "+err.message);stopScanner();}}
function startBarcodeScanning(){if(typeof ZXing==='undefined'){status.textContent="Error: Scanner library not loaded";return;}
codeReader=new ZXing.BrowserMultiFormatReader();codeReader.decodeFromVideoDevice(null,video,(result,err)=>{if(result){const scannedText=result.text;handleScanResult(scannedText,'barcode');}if(err){if(!(err instanceof ZXing.NotFoundException)){console.error("Scan error:",err);}}});}
function captureImage(){if(!videoStream||!isScanning)return;canvas.width=video.videoWidth;canvas.height=video.videoHeight;context.drawImage(video,0,0,canvas.width,canvas.height);progress.style.display='block';progressBar.style.width='0%';status.textContent="Processing image...";recognizeTextFromCanvas();}
async function recognizeTextFromCanvas(){try{progressBar.style.width='30%';status.textContent="Initializing text recognition...";const worker=await Tesseract.createWorker('eng');progressBar.style.width='60%';status.textContent="Recognizing text...";const {data:{text}}=await worker.recognize(canvas);progressBar.style.width='90%';status.textContent="Finalizing...";await worker.terminate();progressBar.style.width='100%';if(text&&text.trim()!==''){const cleanText=text.trim().replace(/\n/g,' ').replace(/\s+/g,' ');handleScanResult(cleanText,'text');}else{status.textContent="No text found in image";setTimeout(()=>{progress.style.display='none';status.textContent="Ready - Tap capture button to try again";},2000);}}catch(error){console.error("Text recognition error:",error);status.textContent="Error recognizing text";progress.style.display='none';}}
function handleScanResult(resultText,source){if(!resultText)return;input.value=resultText;render(resultText);addToHistory(resultText,source);stopScanner();status.textContent=`${source==='barcode'?'Barcode':'Text'} scanned successfully! Barcode generated.`;}
function addToHistory(text,source){scanHistoryData.unshift({text:text,source:source,timestamp:new Date().toLocaleTimeString()});if(scanHistoryData.length>8){scanHistoryData=scanHistoryData.slice(0,8);}
localStorage.setItem('scanHistory',JSON.stringify(scanHistoryData));updateScanHistory();}
function updateScanHistory(){scanHistory.innerHTML='';if(scanHistoryData.length===0){scanHistory.innerHTML='<div class="empty-state">No scans yet</div>';return;}
scanHistoryData.forEach(item=>{const historyItem=document.createElement('div');historyItem.className='history-item';const sourceIcon=item.source==='barcode'?'üì∑':item.source==='text'?'üî§':'‚å®Ô∏è';const sourceText=item.source==='barcode'?'Barcode':item.source==='text'?'Text':'Manual';historyItem.innerHTML=`<span>${sourceIcon}</span><div class="history-content">${item.text}</div><span class="history-type">${sourceText}</span>`;scanHistory.appendChild(historyItem);});}
function stopScanner(){if(codeReader){codeReader.reset();codeReader=null;}if(videoStream){videoStream.getTracks().forEach(track=>track.stop());videoStream=null;video.srcObject=null;}cameraSection.style.display="none";isScanning=false;progress.style.display='none';}
function clearAll(){input.value="";render("");status.textContent="Cleared - Select mode and scan";}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
